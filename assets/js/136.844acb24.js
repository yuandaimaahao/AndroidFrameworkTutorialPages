(window.webpackJsonp=window.webpackJsonp||[]).push([[136],{569:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("这是一个介绍 Android 平台日志系统的系列文章：")]),s._v(" "),t("ul",[t("li",[s._v("Android 平台日志系统整体框架 （本文）")]),s._v(" "),t("li",[s._v("logd 守护进程初始化过程")]),s._v(" "),t("li",[s._v("客户端写日志过程分析")]),s._v(" "),t("li",[s._v("logd 写日志过程分析")]),s._v(" "),t("li",[s._v("冗余日志处理过程分析")]),s._v(" "),t("li",[s._v("logcat 读日志过程分析")]),s._v(" "),t("li",[s._v("logd 读日志过程分析")]),s._v(" "),t("li",[s._v("内核日志处理分析")]),s._v(" "),t("li",[s._v("SeLinux 日志处理分析")])]),s._v(" "),t("p",[s._v("本文基于 AOSP android-10.0.0_r41 版本讲解")]),s._v(" "),t("h2",{attrs:{id:"_1-日志的类别与基本使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-日志的类别与基本使用"}},[s._v("#")]),s._v(" 1. 日志的类别与基本使用")]),s._v(" "),t("p",[s._v("在 Android 系统中，常见的日志有 5 类，main、radio、events、system、crash：")]),s._v(" "),t("p",[t("strong",[s._v("main 日志")])]),s._v(" "),t("p",[s._v("main 日志是应用层 App 唯一可用的日志类型。")]),s._v(" "),t("p",[s._v("在 Java 层提供了 "),t("code",[s._v("android.util.Log")]),s._v(" 接口来写 main 日志：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 写 VERBOSE 等级的日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("v")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YOUR TAG"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Message body"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 写 DEBUG 等级的日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("d")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YOUR TAG"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Message body"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 写 INFO 等级的日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("i")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YOUR TAG"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Message body"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 写 WARN 等级的日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("w")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YOUR TAG"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Message body"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 写 ERROR 等级的日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("e")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YOUR TAG"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Message body"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[t("code",[s._v("android.util.Log")]),s._v(" 接口提供了 5 个方法来写 5 个级别（Level）的日志，日志级别分别为 VERBOSE、DEBUG、INFO、WARN、ERROR、ASSERT，日志级别依次提升：")]),s._v(" "),t("ul",[t("li",[s._v("VERBOSE 级别日志：开发调试中的一些详细信息，仅在开发中使用，不可在发布产品中输出，不是很常见，包含诸如方法名，变量值之类的信息")]),s._v(" "),t("li",[s._v("DEBUG 级别日志：用于调试的信息，可以在发布产品中关闭，比较常见，开发中经常选择输出此种级别的日志，有时在 beta 版应用中出现")]),s._v(" "),t("li",[s._v("INFO 级别日志：该等级日志显示运行状态信息，可在产品出现问题时提供帮助，从该级别开始的日志通常包含完整的文本信息和调试信息，是最常见的日志级别")]),s._v(" "),t("li",[s._v("WARN 级别日志：运行出现异常即将发生错误或表明已发生非致命性错误，该级别日志通常显示出执行过程中的意外情况，例如将 try-catch 语句块中的异常打印堆栈轨迹之后可输出此种级别日志")]),s._v(" "),t("li",[s._v("ERROR 级别日志：已经出现可影响运行的错误，比如应用 crash 时输出的日志")])]),s._v(" "),t("p",[s._v("在 native 层提供了 "),t("code",[s._v("__android_log_print")]),s._v(" 函数来写 main 日志。习惯上，会自定义一些宏来简化 "),t("code",[s._v("__android_log_print")]),s._v(" 函数的使用：")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name function"}},[s._v("ALOGV")]),t("span",{pre:!0,attrs:{class:"token expression"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("__android_log_print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ANDROID_LOG_VERBOSE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LOG_TAG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __VA_ARGS__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name function"}},[s._v("ALOGD")]),t("span",{pre:!0,attrs:{class:"token expression"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("__android_log_print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ANDROID_LOG_DEBUG  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LOG_TAG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __VA_ARGS__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name function"}},[s._v("ALOGI")]),t("span",{pre:!0,attrs:{class:"token expression"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("__android_log_print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ANDROID_LOG_INFO   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LOG_TAG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __VA_ARGS__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name function"}},[s._v("ALOGW")]),t("span",{pre:!0,attrs:{class:"token expression"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("__android_log_print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ANDROID_LOG_WARN   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LOG_TAG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __VA_ARGS__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name function"}},[s._v("ALOGE")]),t("span",{pre:!0,attrs:{class:"token expression"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("__android_log_print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ANDROID_LOG_ERROR  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LOG_TAG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __VA_ARGS__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("与 Java 层类似，在 Natvie 层也有 5 个级别（Level）的日志输出函数。")]),s._v(" "),t("p",[t("strong",[s._v("radio 日志")])]),s._v(" "),t("p",[s._v("radio 日志主要用于记录无线装置/电话相关系统应用的日志，可以调用 "),t("code",[s._v("android.telephony.Rlog")]),s._v(" 打印日志。")]),s._v(" "),t("p",[t("strong",[s._v("events 日志")])]),s._v(" "),t("p",[s._v("events 日志是用来诊断系统问题的。在应用框架提供了 "),t("code",[s._v("android.util.EventLog")]),s._v(" 接口写日志，native 层提供了宏 "),t("code",[s._v("LOG_EVENT_INT、LOG_EVENT_LONG、LOG_EVENT_FLOAT、LOG_EVENT_STRING")]),s._v(" 用来写入 events 类型日志。")]),s._v(" "),t("p",[t("strong",[s._v("system 日志")])]),s._v(" "),t("p",[s._v("system 日志主要用于记录系统应用的日志信息，在 Java 层提供了 "),t("code",[s._v("android.util.SLog")]),s._v(" 接口写入日志， native 层提供了 SLOGV、SLOGD、SLOGI、SLOGW、SLOGE 等宏用来写入 system 类型的日志。")]),s._v(" "),t("p",[t("strong",[s._v("crash 日志")])]),s._v(" "),t("ul",[t("li",[s._v("crash 日志通常是程序 crash 时，记录的日志类型， Java 层使用 "),t("code",[s._v("Log.println()")]),s._v(" （第一个参数设置为  LOG_ID_CRASH）打印 crash 类型的日志")])]),s._v(" "),t("p",[s._v("了解了如何写入日志，接下来我们看看如何读取日志。")]),s._v(" "),t("p",[s._v("通常使用 logcat 命令查看日志：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("logcat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" + 参数\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("可选的参数主要有：")]),s._v(" "),t("ul",[t("li",[s._v("all：查看所有缓冲区日志")]),s._v(" "),t("li",[s._v("default：查看 main、system、crash 三个类型日志信息")]),s._v(" "),t("li",[s._v("main：查看 main 类型日志")]),s._v(" "),t("li",[s._v("radio：查看 radio 类型日志")]),s._v(" "),t("li",[s._v("events：查看 events 类型日志")]),s._v(" "),t("li",[s._v("system：查看 system 类型日志")]),s._v(" "),t("li",[s._v("crash：查看 crash 类型日志")])]),s._v(" "),t("p",[s._v("比如：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("logcat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" main\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用来查看 main 和 system 类型日志")]),s._v("\nlogcat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" main，system\nlogcat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" all "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有日志")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"_2-kernel-层的日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-kernel-层的日志"}},[s._v("#")]),s._v(" 2.Kernel 层的日志")]),s._v(" "),t("p",[s._v("Kernel 层通常使用 "),t("code",[s._v("printk")]),s._v(" 函数来记录日志，具体用法如下：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("// KERN_INFO为日志级别，"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Message body'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v("则为日志信息\nprintk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("KERN_INFO "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Message body'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("kernel 日志级别分别是：KERN_EMERG，KERN_ALERT，KERN_CRIT，KERN_ERR，KERN_WARNING，KERN_NOTICE，KERN_INFO，KERN_DEBUG")]),s._v(" "),t("p",[s._v("这些级别定义在内核源码中的 kern_levels.h 文件中：")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("KERN_EMERGKERN_SOH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* system is unusable */")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("KERN_ALERTKERN_SOH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* action must be taken immediately */")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("KERN_CRITKERN_SOH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* critical conditions */")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("KERN_ERRKERN_SOH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* error conditions */")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("KERN_WARNINGKERN_SOH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4"')]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* warning conditions */")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("KERN_NOTICEKERN_SOH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5"')]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* normal but significant condition */")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("KERN_INFOKERN_SOH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6"')]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* informational */")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("KERN_DEBUGKERN_SOH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7"')]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* debug-level messages */")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("Kernel 日志输出到 /proc/kmsg 文件，用户可以通过读取这个文件来获取 kernel 日志：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/kmsg\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_3-日志系统整体框架"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-日志系统整体框架"}},[s._v("#")]),s._v(" 3. 日志系统整体框架")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/stingerzou/MyImages@main/20231120132917.png",alt:""}})]),s._v(" "),t("p",[s._v("图片来自"),t("a",{attrs:{href:"https://mp.weixin.qq.com/s/CWyXYgwCkidC3n3qukVLSQ",target:"_blank",rel:"noopener noreferrer"}},[s._v("Android logd日志简介及典型案例分析"),t("OutboundLink")],1),s._v(",稍作修改。")]),s._v(" "),t("p",[s._v("系统启动时，init 进程会启动 logd 进程，logd 进程会启动多个子线程，我们主要关注其中的三个：")]),s._v(" "),t("ul",[t("li",[s._v("LogListener，启动一个 Unix Domain Socket 服务端，socket 服务端对应的文件是 "),t("code",[s._v("/dev/socket/logdw")]),s._v("，用于接受 App 发送的 socket 远程请求，向 LogBuffer 写入日志")]),s._v(" "),t("li",[s._v("LogReader，启动一个 Unix Domain Socket 服务端，socket 服务端对应的文件是 "),t("code",[s._v("/dev/socket/logdr")]),s._v("，用于接受 logcat 命令发送的 socket 远程请求，从 LogBuffer 中读出日志")]),s._v(" "),t("li",[s._v("CommandListener，启动一个 Unix Domain Socket 服务端，socket 服务端对应的文件是 "),t("code",[s._v("/dev/socket/logd")]),s._v("，用于接受 logcat 命令发送的 socket 远程请求，向 LogBuffer 发送管理命令")])]),s._v(" "),t("p",[s._v("App 端写入日志时，最终都是调用到 "),t("code",[s._v("__android_log_write")]),s._v(" 函数，通过 socket 远程调用，向 LogListener 发送消息，LogListener 读出 socket 消息，在写入 LogBuffer中")]),s._v(" "),t("p",[s._v("调用 logcat 命令时，最终都是调用到 "),t("code",[s._v("__android_logger_read")]),s._v(" 和 "),t("code",[s._v("SendLogdControlMessage")]),s._v(" 函数，前者通过 socket 远程调用，向 LogReader 发送消息，LogReader 读出 socket 消息，接着从 LogBuffer 中读出日志信息；后者通过 socket 远程调用，向  CommandListener 发送消息，LogReader 读出 socket 消息，接着向 LogBuffer 发送管理命令")]),s._v(" "),t("h2",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://blog.csdn.net/super_marie/article/details/123616543",target:"_blank",rel:"noopener noreferrer"}},[s._v("Android Logd框架梳理"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/mafei852213034/article/details/117780400",target:"_blank",rel:"noopener noreferrer"}},[s._v("Android10.0 日志系统分析(二)-logd、logcat架构分析及日志系统初始化-[Android取经之路]"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.jianshu.com/p/0e4cd3867a8e",target:"_blank",rel:"noopener noreferrer"}},[s._v("深入理解安卓日志系统（logcat / liblog / logd）"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/shift_wwx/article/details/89138117",target:"_blank",rel:"noopener noreferrer"}},[s._v("Android中 logd 详解"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s/CWyXYgwCkidC3n3qukVLSQ",target:"_blank",rel:"noopener noreferrer"}},[s._v("Android logd日志简介及典型案例分析"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/ldswfun/article/details/119920794?spm=1001.2014.3001.5501",target:"_blank",rel:"noopener noreferrer"}},[s._v("Android 10 根文件系统和编译系统(六)：log系统和logcat命令"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://jekton.github.io/2019/03/20/android9-logd-init/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Android P 源码分析 4 - logd 的初始化"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://jekton.github.io/2018/05/17/logd-writing-part2/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Android log 机制 - logd 如何接收 log 数据（下）"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"关于"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于"}},[s._v("#")]),s._v(" 关于")]),s._v(" "),t("p",[s._v("我叫阿豪，2015 年本科毕业于国防科学技术大学指挥信息系统专业，毕业后从事信息化装备的研发工作，工作内容主要涉及 Android Framework 与 Linux Kernel。")]),s._v(" "),t("p",[s._v("如果你对 Android Framework 感兴趣或者正在学习 Android Framework，可以关注我的微信公众号和抖音，我会持续分享我的学习经验，帮助正在学习的你少走一些弯路。学习过程中如果你有疑问或者你的经验想要分享给大家可以添加我的微信，我拉你进技术交流群。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/zzh0838/MyImages@main/img/%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg",alt:""}})])])}),[],!1,null,null,null);t.default=e.exports}}]);